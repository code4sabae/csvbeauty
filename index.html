<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<title>csvbeauty</title>
<script type="module">
import { CSV } from "https://code4sabae.github.io/js/CSV.js";
import { SJIS } from "https://code4sabae.github.io/js/SJIS.js";
import { downloadZip } from "https://code4sabae.github.io/js/downloadZip.js";
import { waitDropFiles } from "https://code4sabae.github.io/js/waitDropFiles.js";
import { downloadTextFile } from "https://code4sabae.github.io/js/downloadTextFile.js";
import { readAsArrayBufferAsync } from "https://code4sabae.github.io/js/readAsArrayBufferAsync.js";

window.onload = async () => {
    divmain.innerHTML = "CSVファイルをドロップしてください";
    const items = await waitDropFiles(divmain);
    const files = [];
    for (const item of items) {
        if (item.type !== "text/csv") {
            alert("ファイル形式が違います。CSVファイルをドロップしてください。")
            return;
        }
        try {
            const file = item.file;
            const bin = await readAsArrayBufferAsync(file);
            const data = SJIS.decodeAuto(new Uint8Array(bin));
            const csv = CSV.decode(data);
            const scsv = CSV.encode(csv);
            files.push({ name: file.name, data: scsv });
        } catch (e) {
            console.log(e);
            alert("CSVファイルの読み込みに失敗しました。データが正常かご確認ください。");
            return;
        }
    }
    if (files.length == 1) {
        downloadTextFile(files[0]);
    } else {
        downloadZip("csvs.zip", files);
    }
};
</script>
</head>
<body>
    
<div class="jumbotron">
    <h1 class="display-4">csvbeauty</h1>
    <p class="lead">CSVファイルをBOM付きUTF-8に変換します（まとめて変換対応）</p>
</div>

<div class="mx-5">
    <div id="divmain" class="border px-5 mx-auto pt-3 pb-3">
    </div>
</div>

<footer class="text-muted">
  <div class="container my-4 mx-0">
    <p>Design: <a href="https://getbootstrap.com/">Bootstrap</a> by <a href="https://twitter.com/mdo">@mdo</a></p>
    <p>App: CC BY <a href="https://fukuno.jig.jp/3115">福野泰介の一日一創</a> by <a href="https://twitter.com/taisukef">@taisukef</a></p>
  </div>
</footer>

</body>
</html>
